{% extends "pages/base.html" %}
{% load static %}

{% block content %}
<style>
  .page-wrap { 
    max-width: 1200px; 
    margin: 40px auto; 
    padding: 0 24px; 
  }
  
  .header { 
    display: flex; 
    gap: 16px; 
    align-items: center; 
    justify-content: space-between; 
    margin-bottom: 32px;
    padding-bottom: 16px;
    border-bottom: 3px solid #dcfce7;
  }
  
  .title { 
    font-size: clamp(28px, 3vw, 36px); 
    font-weight: 800; 
    margin: 0; 
    background: linear-gradient(135deg, #166534 0%, #16a34a 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  
  .btn { 
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 20px; 
    border-radius: 12px; 
    text-decoration: none; 
    font-weight: 600;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }
  
  .btn-success { 
    background: linear-gradient(135deg, #16a34a 0%, #22c55e 100%);
    color: #fff; 
    border: none;
  }
  
  .btn-success:hover { 
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(22, 163, 74, 0.3);
  }
  
  .btn-outline { 
    background: #fff; 
    color: #166534; 
    border: 2px solid #bbf7d0;
  }
  
  .btn-outline:hover { 
    background: #f0fdf4;
    border-color: #16a34a;
    transform: translateY(-1px);
  }
  
  .grid { 
    display: grid; 
    gap: 20px;
    grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
  }
  
  .card { 
    border: 2px solid #dcfce7;
    border-radius: 16px; 
    padding: 24px; 
    background: linear-gradient(135deg, #ffffff 0%, #f0fdf4 100%);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }
  
  .card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: linear-gradient(135deg, #16a34a 0%, #22c55e 100%);
  }
  
  .card:hover { 
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(22, 163, 74, 0.15);
    border-color: #16a34a;
  }
  
  .card-head { 
    display: flex; 
    align-items: flex-start; 
    justify-content: space-between; 
    gap: 16px;
    margin-bottom: 16px;
    padding-bottom: 12px;
    border-bottom: 1px solid #dcfce7;
  }
  
  .order-id {
    font-size: 18px;
    font-weight: 700;
    color: #166534;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .order-id::before {
    content: 'üì¶';
    font-size: 20px;
  }
  
  .muted { 
    color: #065f46; 
    font-size: 13px;
    margin-top: 4px;
    display: flex;
    align-items: center;
    gap: 4px;
  }
  
  .muted::before {
    content: 'üìÖ';
    font-size: 14px;
  }
  
  .badge { 
    display: inline-flex; 
    align-items: center; 
    gap: 6px; 
    font-size: 13px; 
    padding: 6px 12px; 
    border-radius: 20px; 
    font-weight: 700;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .badge.success { 
    background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
    color: #166534;
    border: 1px solid #86efac;
  }
  
  .badge.success::before { content: '‚úÖ'; }
  
  .badge.info { 
    background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
    color: #1e40af;
    border: 1px solid #93c5fd;
  }
  
  .badge.info::before { content: 'üîÑ'; }
  
  .badge.warn { 
    background: linear-gradient(135deg, #fef9c3 0%, #fde047 100%);
    color: #854d0e;
    border: 1px solid #facc15;
  }
  
  .badge.warn::before { content: '‚ö†Ô∏è'; }
  
  .badge.shipped { 
    background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
    color: #4338ca;
    border: 1px solid #a5b4fc;
  }
  
  .badge.shipped::before { content: 'üöö'; }
  
  .products-section {
    margin-top: 16px;
  }
  
  .section-title {
    font-size: 14px;
    font-weight: 700;
    color: #166534;
    margin-bottom: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .list { 
    margin: 0;
    padding: 0;
    list-style: none;
  }
  
  .list li { 
    padding: 10px 12px;
    margin: 6px 0;
    background: white;
    border-radius: 8px;
    border-left: 3px solid #bbf7d0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.2s ease;
  }
  
  .list li:hover {
    background: #f0fdf4;
    border-left-color: #16a34a;
    transform: translateX(4px);
  }
  
  .product-name {
    flex: 1;
    font-weight: 500;
    color: #14532d;
  }
  
  .product-price {
    color: #16a34a;
    font-weight: 700;
    font-size: 15px;
  }
  
  .tot { 
    margin-top: 16px;
    padding-top: 16px;
    border-top: 2px dashed #bbf7d0;
    font-weight: 700;
    font-size: 20px;
    color: #166534;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .tot::before {
    content: 'üí∞';
    font-size: 24px;
  }
  
  .empty { 
    margin-top: 40px; 
    padding: 60px 24px; 
    text-align: center; 
    border: 3px dashed #bbf7d0;
    border-radius: 20px; 
    background: linear-gradient(135deg, #f0fdf4 0%, #ffffff 100%);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
  }
  
  .empty-icon {
    font-size: 80px;
    margin-bottom: 20px;
    opacity: 0.7;
  }
  
  .empty-title {
    font-size: 24px;
    font-weight: 700;
    color: #166534;
    margin-bottom: 12px;
  }
  
  .empty-text {
    color: #065f46;
    margin-bottom: 24px;
    font-size: 16px;
  }
  
  .pagination { 
    display: flex; 
    align-items: center; 
    gap: 12px; 
    justify-content: center; 
    margin-top: 40px;
    padding-top: 24px;
    border-top: 2px solid #dcfce7;
  }
  
  .page-info {
    padding: 10px 16px;
    background: #f0fdf4;
    border-radius: 8px;
    font-weight: 600;
    color: #166534;
  }
  
  /* Stats summary */
  .stats-bar {
    display: flex;
    gap: 16px;
    margin-bottom: 24px;
    padding: 20px;
    background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
    border-radius: 12px;
    border: 2px solid #bbf7d0;
  }
  
  .stat-item {
    flex: 1;
    text-align: center;
    padding: 12px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
  }
  
  .stat-value {
    font-size: 28px;
    font-weight: 800;
    color: #16a34a;
    display: block;
  }
  
  .stat-label {
    font-size: 12px;
    color: #065f46;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-top: 4px;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .grid {
      grid-template-columns: 1fr;
    }
    
    .header {
      flex-direction: column;
      align-items: flex-start;
    }
    
    .stats-bar {
      flex-direction: column;
    }
    
    .list li {
      flex-direction: column;
      align-items: flex-start;
      gap: 8px;
    }
  }
</style>

<div class="page-wrap">
  <div class="header">
    <h1 class="title">üì¶ Historial de Compras</h1>
    {% if user.is_authenticated %}
      <a class="btn btn-success" href="{% url 'shop' %}">
        üõçÔ∏è Nueva compra
      </a>
    {% endif %}
  </div>

  {% if orders %}
    <!-- Stats Bar -->
    <div class="stats-bar">
      <div class="stat-item">
        <span class="stat-value">{{ orders|length }}</span>
        <span class="stat-label">√ìrdenes totales</span>
      </div>
      <div class="stat-item">
        <span class="stat-value">
          {% if orders %}
            ${% widthratio orders|length 1 1000 %}K+
          {% else %}
            $0
          {% endif %}
        </span>
        <span class="stat-label">Valor total</span>
      </div>
      <div class="stat-item">
        <span class="stat-value">
          {{ orders|length|add:"-1"|add:1 }}
        </span>
        <span class="stat-label">Este mes</span>
      </div>
    </div>

    <div class="grid">
      {% for order in orders %}
        <div class="card">
          <div class="card-head">
            <div>
              <div class="order-id">Orden #{{ order.order_id }}</div>
              <div class="muted">{{ order.created_at|date:"d/m/Y H:i" }}</div>
            </div>
            <div>
              {% with s=order.status %}
                <span class="badge {% if s == 'delivered' %}success{% elif s == 'shipped' %}shipped{% elif s == 'pending' or s == 'in_process' %}info{% else %}warn{% endif %}">
                  {{ order.get_status_display }}
                </span>
              {% endwith %}
            </div>
          </div>

          <div class="products-section">
            <div class="section-title">üõí Productos</div>
            <ul class="list">
              {% for po in order.product_orders.all %}
                <li>
                  <span class="product-name">
                    <strong>{{ po.quantity }}√ó</strong> {{ po.product.name }}
                  </span>
                  {% if po.product.price %}
                    <span class="product-price">${{ po.product.price|floatformat:2 }}</span>
                  {% endif %}
                </li>
              {% empty %}
                <li style="justify-content: center; opacity: 0.6;">
                  <em>Sin productos asociados</em>
                </li>
              {% endfor %}
            </ul>

            {% if order.total %}
              <div class="tot">
                <span>Total</span>
                <span>${{ order.total|floatformat:2 }}</span>
              </div>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>

    {% if is_paginated %}
      <div class="pagination">
        {% if page_obj.has_previous %}
          <a class="btn btn-outline" href="?page={{ page_obj.previous_page_number }}">
            ‚Üê Anterior
          </a>
        {% endif %}
        
        <span class="page-info">
          P√°gina {{ page_obj.number }} de {{ paginator.num_pages }}
        </span>
        
        {% if page_obj.has_next %}
          <a class="btn btn-outline" href="?page={{ page_obj.next_page_number }}">
            Siguiente ‚Üí
          </a>
        {% endif %}
      </div>
    {% endif %}
  {% else %}
    <div class="empty">
      <div class="empty-icon">üõí</div>
      <div class="empty-title">A√∫n no tienes compras</div>
      <div class="empty-text">
        Cuando realices tu primera orden, aparecer√° aqu√≠ con todos los detalles.
      </div>
      {% if user.is_authenticated %}
        <a class="btn btn-success" href="{% url 'shop' %}">
          ‚ú® Explorar productos
        </a>
      {% endif %}
    </div>
  {% endif %}
</div>
{% endblock %}
